# WWC architecture with AGF
![[2024-10-08_14-41.png]]

W-5GAN comprises of **wireline access nodes and an adaption function for 5G convergence**, i.e., the AGF. The **AGF may be split into control plane**, AGF-CP, **and user plane**, AGF-UP. The **control plane and user plane separation (CUPS)** of the AGF is out of scope of this document and is specified in TR-458.

The user devices (i.e., UE, PC, and STB) access to the 5G Core Network through the 5G-RG or the FN-RG and W-5GAN.

To support an FN-RG, the AGF emulates the N1 interface. The AGF generates and exchanges the Non-Access Stratum (NAS) signaling to the AMF on behalf of the FN-RG.

# 6.1.1 Primary Authentication
In order to access to 5GC, each subscriber is allocated one 5G Subscription Permanent Identifier (SUPI) for use within the 3GPP system.

The SUPI is the permanent identity that identifies the subscriber and it is used only inside the 3GPP system. The SUPI, in respect to the 5G system, **is never provided by UE to the network element, but it is confined to the core network and exchanged between the NF(s) in the core network**. 

The UE in the procedure communicates its Subscription Concealed Identifier (SUCI). The exception is the case of Emergency Services, where the identification of UE, take precedence over the privacy requirements. TR-470 section 7.5 (SUPI/SUCI for FN-RG) provides additional background information about SUPI and SUCI usage for FN-RG.

# 6.1.2 Additional Authentication
An AGF supporting PPPoE will be **configured to require either PAP or CHAP authentication** and will negotiate this during LCP procedures.

An AGF **in the absence of either an attached RADIUS** server or the presence of additional authentication information in RG-LWAC **will always treat PAP or CHAP authentication attempts as valid and reply in kind**.

As such an AGF **may be configured to promiscuously accept PAP/CHAP authentication** in lieu of having access to network support.

> An AGF configured to accept PAP authentication MUST always respond to a PAP Authenticate-Request with an Authenticate-ACK upon successful registration with the 5GC.

> An AGF MUST initiate a CHAP Challenge to the PPP peer. Upon receipt of the CHAP Response, an AGF configured to accept CHAP authentication MUST always respond with a CHAP Success upon successful registration with the 5GC.

Additional authentication beyond the primary authentication may be performed for an FN-RG.
This may be achieved by a **combined AGF/BNG using existing RADIUS infrastructure**, or for a **combined AGF/BNG** or **standalone AGF**, via the **dissemination of PAP/CHAP credentials** information **encoded in Additional Authentication Credentials Information (AACI) in the RG-LWAC data structure obtained from UDM at registration time**, see section 7.6 of TR-470. The NAI in an AACI is expected to be unique for a given subscriber, such that no two AACI TLVs in a given RG-LWAC will contain a common NAI.

# 6.2.1 N1 (NAS) Security for AGF in adaptive mode
Unlike NAS messages generated by 5G-RG, **integrity protection and ciphering for NAS messages generated by the AGF on behalf of FN-RG are not required because the AGF is assumed to be in the same domain as the 5GC**. Scenarios where the AGF is in a different domain to the 5GC are FFS.

# 6.2.2 N2 Security
It is an Operator's decision whether to implement encryption on N2. **Encryption on N2 can be implemented on the AGF** or can be **achieved via an external security gateway**

For Wireline Access (AGF), an external security gateway (SEG) on the access side can be used to provide IPSec/DTLS based encryption support in case the Operator wants to secure the N2 endpoints.

> The SEG is an external device and it is not managed by AGF or 5G Control Plane.

# 6.2.3 User Plane Data Security (N3)
TS 33.501 Clause 9.3 provides option to use SEG to terminate the IPSec tunnel for N3 Endpoint on the core network side (UPF).

In case of Wireline Access, a SEG can be used to terminate the IPSec tunnel for N3 Endpoint on the AGF side.

# 6.3.2 User plane for FN-RG
The user plane encoding employed for PDU exchange between an AGF and an FN-RG is based on the traditional wireline protocols documented in TR-101/178 (such as IPoverPPP and IPoE)
![[Screenshot from 2024-10-09 10-53-55.png]]

The user plane connection between FN-RG and AGF follows the IP-session lifecycle management as defined in TR-101/TR-178 and between the AGF and UPF follows the PDU session management as defined in TS 23.502. AGF proxies the FN-RG to establish the user plane connection to the 5GC by initiating PDU Session establishment.

# 6.4 Control plane
Control plane traffic is originated by an **AGF on behalf of an FN-RG.**
- The AGF must support Point-to-Point Protocol (PPP)
- The AGF MUST be able to receive the Line ID from the AN
- The AGF MUST be able to construct the Global Line ID (GLI)
- The AGF MUST be able to encode the GLI into a User Location Information
- The AGF MUST be able to construct a Global W-AGF ID to globally identify an AGF node and populate the Global RAN Node ID in N2 messages

The AGF determines the class of RG it is supporting on the basis of session initiation traffic received by the AGF from the RG. The formal requirements for detection of class of RG are as follows:
- The AGF that is configured to support adaptive mode MUST reply to a PADI containing a NULL length service-name tag with a PADO containing a NULL length service-name tag.

## 6.4.2 Control plane for FN-RG
An AGF proxies 5G control plane connectivity for an FN-RG. The protocol stack used for control plane is shown in Figure 18:
![[Screenshot from 2024-10-09 14-05-39.png]]

FN-RG initiates the connection with the AGF-CP as described in TR-101. The V interface used for FN-RG connection follows the requirements as defined in TR-101 Issue2 for BNG. **The AGF-CP treats the IP session initiation as a trigger to perform a proxy registration for the FN-RG and establishes the NAS connection with the AMF where the NAS message overlays the N2 interface as defined for 5G-RG.**

